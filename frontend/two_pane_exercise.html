<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>診断士二次 演習UIプロトタイプ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@700&family=Noto+Sans+JP:wght@400;500;700&family=Noto+Sans+Mono:wght@500&display=swap"
      rel="stylesheet"
    />
    <style>
      body[data-app="exercise"] {
        /* カラーと余白のカスタムプロパティ */
        --color-bg: #f2f4f7;
        --color-surface: #ffffff;
        --color-text: #1b2337;
        --color-text-strong: #111a2b;
        --color-border: rgba(27, 35, 55, 0.18);
        --color-chip-bg: rgba(27, 35, 55, 0.12);
        --color-chip-active: #1c2f55;
        --color-chip-active-text: #ffffff;
        --color-warning: #b11c34;
        --color-text-muted: #5a6378;
        --color-card-i: #fbe7ef; /* 桜 */
        --color-card-ii: #e0f2d8; /* 若草 */
        --color-card-iii: #ddeafe; /* 空 */
        --color-card-iv: #dfe2ff; /* 瑠璃 */
        --color-focus-ring: rgba(39, 71, 128, 0.55);
        --radius-card: 16px;
        --spacing-lg: 32px;
        --spacing-md: 16px;
        --spacing-sm: 12px;
        --spacing-xs: 8px;
        --transition-duration: 200ms;
        --font-heading-xl: clamp(1.9rem, 1.6rem + 0.5vw, 2.2rem);
        --font-heading-lg: clamp(1.45rem, 1.3rem + 0.3vw, 1.6rem);
        --font-heading-md: clamp(1.2rem, 1.12rem + 0.2vw, 1.32rem);
        font-size: 16px;
      }

      @media (prefers-color-scheme: dark) {
        body[data-app="exercise"] {
          --color-bg: #0d1424;
          --color-surface: rgba(18, 26, 44, 0.88);
          --color-text: #e7ecf5;
          --color-text-strong: #f7f9ff;
          --color-border: rgba(231, 236, 245, 0.2);
          --color-chip-bg: rgba(231, 236, 245, 0.12);
          --color-chip-active: #5a7edb;
          --color-chip-active-text: #0d1424;
          --color-warning: #f87171;
          --color-text-muted: rgba(231, 236, 245, 0.76);
          --color-card-i: rgba(248, 165, 200, 0.24);
          --color-card-ii: rgba(190, 242, 145, 0.24);
          --color-card-iii: rgba(147, 197, 253, 0.24);
          --color-card-iv: rgba(129, 140, 248, 0.24);
          --color-focus-ring: rgba(120, 150, 240, 0.65);
        }
      }

      body[data-app="exercise"] *,
      body[data-app="exercise"] *::before,
      body[data-app="exercise"] *::after {
        box-sizing: border-box;
      }

      body[data-app="exercise"] {
        margin: 0;
        font-family: "Noto Sans JP", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
        background-color: var(--color-bg);
        color: var(--color-text);
        line-height: 1.6;
        text-rendering: optimizeLegibility;
      }

      body[data-app="exercise"] h1,
      body[data-app="exercise"] .heading-xl {
        font-size: var(--font-heading-xl);
        font-weight: 700;
        line-height: 1.28;
        letter-spacing: 0.01em;
        margin: 0 0 var(--spacing-sm);
        font-family: "M PLUS Rounded 1c", "Noto Sans JP", sans-serif;
        color: var(--color-text-strong);
      }

      body[data-app="exercise"] h2,
      body[data-app="exercise"] .heading-lg {
        font-size: var(--font-heading-lg);
        font-weight: 700;
        line-height: 1.3;
        margin: 0 0 var(--spacing-sm);
        font-family: "M PLUS Rounded 1c", "Noto Sans JP", sans-serif;
        color: var(--color-text-strong);
      }

      body[data-app="exercise"] h3,
      body[data-app="exercise"] .heading-md {
        font-size: var(--font-heading-md);
        font-weight: 700;
        line-height: 1.35;
        margin: 0 0 var(--spacing-xs);
        font-family: "M PLUS Rounded 1c", "Noto Sans JP", sans-serif;
        color: var(--color-text-strong);
      }

      body[data-app="exercise"] p {
        margin: 0 0 var(--spacing-sm);
      }

      body[data-app="exercise"] .text-muted {
        color: var(--color-text-muted);
      }

      body[data-app="exercise"] a {
        color: inherit;
      }

      body[data-app="exercise"] .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      body[data-app="exercise"] a:focus-visible,
      body[data-app="exercise"] button:focus-visible,
      body[data-app="exercise"] textarea:focus-visible,
      body[data-app="exercise"] [role="button"]:focus-visible {
        outline: none;
        box-shadow: 0 0 0 3px var(--color-focus-ring);
        border-radius: 8px;
      }

      body[data-app="exercise"] .layout {
        display: flex;
        align-items: flex-start;
        gap: var(--spacing-lg);
        max-width: 1200px;
        margin: 0 auto;
        padding: var(--spacing-lg) var(--spacing-md) calc(var(--spacing-lg) * 2);
      }

      body[data-app="exercise"] .context-pane {
        position: sticky;
        top: var(--spacing-lg);
        max-height: calc(100vh - var(--spacing-lg) * 2);
        overflow-y: auto;
        flex: 0 0 380px;
        padding: var(--spacing-lg) var(--spacing-md);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-card);
        background-color: var(--color-surface);
        box-shadow: 0 16px 32px rgba(16, 24, 40, 0.08);
      }

      @media (prefers-color-scheme: dark) {
        body[data-app="exercise"] .context-pane {
          background-color: var(--color-surface);
        }
      }

      body[data-app="exercise"] .context-pane__header {
        margin-bottom: var(--spacing-md);
      }

      body[data-app="exercise"] .context-pane__miniheader {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-xs);
        align-items: center;
        font-size: 0.9rem;
        color: var(--color-text-muted);
      }

      body[data-app="exercise"] .context-pane__miniheader strong {
        color: var(--color-text);
      }

      body[data-app="exercise"] .context-pane__meta {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: var(--spacing-xs) var(--spacing-sm);
        font-size: 0.88rem;
        color: var(--color-text-muted);
        font-family: "Noto Sans Mono", "Noto Sans JP", monospace;
      }

      body[data-app="exercise"] .context-pane__meta dt {
        font-weight: 600;
        letter-spacing: 0.02em;
      }

      body[data-app="exercise"] .context-pane__body {
        font-size: 1rem;
        white-space: pre-line;
      }

      body[data-app="exercise"] .exercise {
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        gap: var(--spacing-lg);
        min-width: 0;
      }

      body[data-app="exercise"] .exercise__tabs {
        position: sticky;
        top: var(--spacing-lg);
        z-index: 5;
        display: flex;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm) var(--spacing-md);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-card);
        background-color: var(--color-bg);
        background: linear-gradient(
          180deg,
          var(--color-bg) 0%,
          color-mix(in srgb, var(--color-bg) 60%, transparent)
        );
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        scrollbar-width: thin;
      }

      body[data-app="exercise"] .exercise__tabs::-webkit-scrollbar {
        height: 6px;
      }

      body[data-app="exercise"] .exercise__tabs::-webkit-scrollbar-thumb {
        background-color: rgba(27, 35, 55, 0.25);
        border-radius: 999px;
      }

      body[data-app="exercise"] .exercise-tab {
        display: inline-flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 2px;
        min-width: 168px;
        padding: 10px 14px;
        border-radius: 14px;
        border: 1px solid transparent;
        background-color: var(--color-chip-bg);
        color: var(--color-text);
        font-size: 0.95rem;
        font-weight: 600;
        letter-spacing: 0.01em;
        cursor: pointer;
        transition: background-color var(--transition-duration) ease,
          color var(--transition-duration) ease,
          border-color var(--transition-duration) ease,
          box-shadow var(--transition-duration) ease;
        scroll-snap-align: start;
      }

      body[data-app="exercise"] .exercise-tab__label {
        font-family: "Noto Sans Mono", "Noto Sans JP", monospace;
        font-size: 0.78rem;
        text-transform: uppercase;
        color: var(--color-text-muted);
      }

      body[data-app="exercise"] .exercise-tab__title {
        font-family: "M PLUS Rounded 1c", "Noto Sans JP", sans-serif;
        font-weight: 700;
        color: var(--color-text-strong);
      }

      body[data-app="exercise"] .exercise-tab:hover,
      body[data-app="exercise"] .exercise-tab:focus-visible {
        border-color: var(--color-chip-active);
        box-shadow: 0 0 0 3px var(--color-focus-ring);
      }

      body[data-app="exercise"] .exercise-tab[aria-selected="true"] {
        background-color: var(--color-chip-active);
        color: var(--color-chip-active-text);
      }

      body[data-app="exercise"] .exercise-tab[aria-selected="true"] .exercise-tab__label,
      body[data-app="exercise"] .exercise-tab[aria-selected="true"] .exercise-tab__title {
        color: var(--color-chip-active-text);
      }

      body[data-app="exercise"] .exercise__questions {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-lg);
      }

      body[data-app="exercise"] .question-card {
        position: relative;
        padding: var(--spacing-lg);
        border-radius: var(--radius-card);
        border: 1px solid var(--color-border);
        background-color: var(--color-card-i);
        box-shadow: none;
        transition: box-shadow var(--transition-duration) ease,
          transform var(--transition-duration) ease;
      }

      body[data-app="exercise"] .question-card:nth-of-type(4n + 2) {
        background-color: var(--color-card-ii);
      }

      body[data-app="exercise"] .question-card:nth-of-type(4n + 3) {
        background-color: var(--color-card-iii);
      }

      body[data-app="exercise"] .question-card:nth-of-type(4n + 4) {
        background-color: var(--color-card-iv);
      }

      body[data-app="exercise"] .question-card:hover,
      body[data-app="exercise"] .question-card:focus-within {
        box-shadow: 0 12px 32px rgba(31, 41, 51, 0.12);
        transform: translateY(-2px);
      }

      body[data-app="exercise"] .question-card__header {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-md);
      }

      body[data-app="exercise"] .question-card__badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 12px;
        background-color: var(--color-chip-active);
        color: var(--color-chip-active-text);
        font-weight: 700;
        font-family: "Noto Sans Mono", "Noto Sans JP", monospace;
      }

      body[data-app="exercise"] .question-card__title {
        font-size: 1.15rem;
        font-weight: 700;
        margin: 0;
        font-family: "M PLUS Rounded 1c", "Noto Sans JP", sans-serif;
        color: var(--color-text-strong);
      }

      body[data-app="exercise"] .question-card__meta {
        margin-left: auto;
        display: flex;
        gap: var(--spacing-sm);
        font-size: 0.9rem;
        color: var(--color-text-muted);
        font-family: "Noto Sans Mono", "Noto Sans JP", monospace;
      }

      body[data-app="exercise"] .question-card__body {
        margin-bottom: var(--spacing-md);
      }

      body[data-app="exercise"] .question-card__input {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-xs);
      }

      body[data-app="exercise"] .question-card__textarea {
        width: 100%;
        min-height: 160px;
        padding: var(--spacing-sm);
        border-radius: 12px;
        border: 1px solid var(--color-border);
        background-color: var(--color-surface);
        color: inherit;
        font-size: 1rem;
        resize: vertical;
        transition: border-color var(--transition-duration) ease,
          box-shadow var(--transition-duration) ease;
      }

      @media (prefers-color-scheme: dark) {
        body[data-app="exercise"] .question-card__textarea {
          background-color: var(--color-surface);
          border-color: var(--color-border);
        }
      }

      body[data-app="exercise"] .question-card__textarea:focus {
        border-color: var(--color-chip-active);
      }

      body[data-app="exercise"] .char-counter {
        align-self: flex-end;
        font-size: 0.85rem;
        color: var(--color-text-muted);
        font-family: "Noto Sans Mono", "Noto Sans JP", monospace;
      }

      body[data-app="exercise"] .char-counter--limit {
        color: var(--color-warning);
        font-weight: 600;
      }

      body[data-app="exercise"] .support-block {
        border-top: 1px solid var(--color-border);
        padding-top: var(--spacing-sm);
        margin-top: var(--spacing-md);
        font-size: 0.9rem;
      }

      body[data-app="exercise"] .support-block__toggle {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-xs);
        cursor: pointer;
        background: none;
        border: 1px solid transparent;
        padding: var(--spacing-xs) var(--spacing-sm);
        font: inherit;
        color: inherit;
        border-radius: 999px;
        transition: background-color var(--transition-duration) ease,
          border-color var(--transition-duration) ease,
          color var(--transition-duration) ease;
      }

      body[data-app="exercise"] .support-block__toggle:hover,
      body[data-app="exercise"] .support-block__toggle:focus-visible {
        background-color: var(--color-chip-bg);
        border-color: var(--color-chip-active);
      }

      body[data-app="exercise"] .support-block__content {
        margin-top: var(--spacing-xs);
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: 8px;
        background-color: rgba(255, 255, 255, 0.55);
        color: var(--color-text-muted);
      }

      body[data-app="exercise"] .support-block__content[hidden] {
        display: none;
      }

      @media (prefers-color-scheme: dark) {
        body[data-app="exercise"] .support-block__content {
          background-color: rgba(17, 24, 39, 0.55);
        }
      }

      body[data-app="exercise"] .icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        border-radius: 8px;
        background-color: rgba(28, 47, 85, 0.12);
        color: var(--color-chip-active);
        font-size: 0.75rem;
        font-weight: 700;
        line-height: 1;
        letter-spacing: 0.05em;
        transition: background-color var(--transition-duration) ease,
          color var(--transition-duration) ease;
      }

      body[data-app="exercise"] .icon--support::before {
        content: "i";
        font-style: italic;
      }

      body[data-app="exercise"] .support-block__toggle .icon {
        width: 24px;
        height: 24px;
        background-color: rgba(28, 47, 85, 0.12);
        font-size: 0.72rem;
      }

      body[data-app="exercise"] .support-block__toggle:hover .icon,
      body[data-app="exercise"] .support-block__toggle:focus-visible .icon,
      body[data-app="exercise"] .support-block__toggle[aria-expanded="true"] .icon {
        background-color: var(--color-chip-active);
        color: var(--color-chip-active-text);
      }

      body[data-app="exercise"] .support-block__label {
        font-weight: 600;
        letter-spacing: 0.01em;
      }

      @media (prefers-color-scheme: dark) {
        body[data-app="exercise"] .icon {
          background-color: rgba(90, 126, 219, 0.28);
          color: var(--color-chip-active-text);
        }

        body[data-app="exercise"] .support-block__toggle .icon {
          background-color: rgba(90, 126, 219, 0.32);
        }
      }

      body[data-app="exercise"] .question-card--active::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        border: 2px solid var(--color-chip-active);
        pointer-events: none;
        animation: activePulse 2s ease;
      }

      @keyframes activePulse {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }

      body[data-app="exercise"] .exercise__footer {
        position: sticky;
        bottom: 0;
        z-index: 10;
        margin-top: auto;
        background-color: var(--color-bg);
        background: linear-gradient(
          180deg,
          color-mix(in srgb, var(--color-bg) 90%, transparent) 0%,
          var(--color-bg) 55%,
          var(--color-bg) 100%
        );
        border-top: 1px solid var(--color-border);
        padding: var(--spacing-md) var(--spacing-md) calc(var(--spacing-md) + 4px);
        display: flex;
        justify-content: flex-end;
      }

      body[data-app="exercise"] .cta-button {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-xs);
        padding: 12px 20px;
        border-radius: 999px;
        border: 1px solid transparent;
        background-color: var(--color-chip-active);
        color: var(--color-chip-active-text);
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        transition: transform var(--transition-duration) ease,
          box-shadow var(--transition-duration) ease,
          background-color var(--transition-duration) ease;
      }

      body[data-app="exercise"] .cta-button:hover,
      body[data-app="exercise"] .cta-button:focus-visible {
        box-shadow: 0 0 0 3px var(--color-focus-ring);
        transform: translateY(-1px);
      }

      body[data-app="exercise"] .cta-button__verb {
        font-family: "M PLUS Rounded 1c", "Noto Sans JP", sans-serif;
      }

      body[data-app="exercise"] .cta-button__object {
        font-family: "Noto Sans JP", sans-serif;
        font-weight: 600;
      }

      @media (max-width: 1024px) {
        body[data-app="exercise"] .context-pane {
          flex-basis: 320px;
        }
      }

      @media (max-width: 768px) {
        body[data-app="exercise"] .layout {
          flex-direction: column;
        }

        body[data-app="exercise"] .context-pane {
          position: relative;
          top: auto;
          max-height: none;
          width: 100%;
          flex: 1 1 auto;
        }

        body[data-app="exercise"] .exercise__tabs {
          position: sticky;
          top: 0;
        }
      }

      @media (max-width: 600px) {
        body[data-app="exercise"] .layout {
          padding: var(--spacing-md);
        }

        body[data-app="exercise"] .context-pane__miniheader {
          position: sticky;
          top: 0;
          z-index: 10;
          display: flex;
          flex-wrap: wrap;
          gap: var(--spacing-xs);
          align-items: center;
          padding: var(--spacing-xs) 0;
          background-color: var(--color-bg);
        }

        body[data-app="exercise"] .context-pane__miniheader a {
          color: var(--color-chip-active);
          font-size: 0.85rem;
          text-decoration: underline;
        }
      }
    </style>
  </head>
  <body data-app="exercise">
    <div class="layout">
      <aside
        class="context-pane"
        role="region"
        aria-labelledby="context-heading"
      >
        <header class="context-pane__header">
          <div class="context-pane__miniheader">
            <strong>事例I 令和6年</strong>
            <a class="text-muted" href="#question-1">設問一覧へジャンプ</a>
          </div>
          <h1 id="context-heading">B製造業 与件文</h1>
          <dl class="context-pane__meta">
            <dt>業種</dt>
            <dd>精密機器製造</dd>
            <dt>従業員</dt>
            <dd>220名</dd>
            <dt>売上規模</dt>
            <dd>58億円</dd>
            <dt>キーワード</dt>
            <dd>技能伝承 / 開発連携</dd>
          </dl>
        </header>
        <div class="context-pane__body">
          <!-- 与件文を常時参照できるよう縦スクロール可能に配置 -->
          A社は創業40年の精密機器メーカーである。創業者の引退を契機に、
          2代目社長は設計部門のDX化と熟練技術者の技能伝承を最優先テーマ
          と定めた。設計BOMと生産BOMが分断されており、製品立ち上げ時の
          手戻りが多発している。また、顧客ニーズの高度化に伴い、多品種小
          ロットかつ短納期での開発対応が求められている。

          現状、設計段階での顧客折衝は営業部門が単独で担っており、設計の
          観点が十分に反映されていない。生産部門ではベテラン技能者の高齢
          化が進み、暗黙知の形式知化が急務となっている。社長は部門横断で
          の情報共有と意思決定スピードの改善を目指し、試験的にデジタル・
          コラボレーション基盤を導入した。

          今後は、設計段階からの顧客共創、外部パートナーとの連携強化、そ
          れに伴う評価制度の再設計が検討課題である。
        </div>
      </aside>

      <main class="exercise" role="main" aria-labelledby="exercise-heading">
        <h2 id="exercise-heading" class="sr-only">演習と設問</h2>
        <nav
          class="exercise__tabs"
          role="tablist"
          aria-label="設問タブ"
          data-wheel-scroll="true"
        >
          <!-- ホイールでも操作できる設問タブ -->
          <button
            id="tab-question-1"
            class="exercise-tab"
            type="button"
            role="tab"
            aria-selected="true"
            aria-controls="question-1"
            tabindex="0"
            data-target="question-1"
          >
            <span class="exercise-tab__label">Q1</span>
            <span class="exercise-tab__title">経営課題の整理</span>
          </button>
          <button
            id="tab-question-2"
            class="exercise-tab"
            type="button"
            role="tab"
            aria-selected="false"
            aria-controls="question-2"
            tabindex="-1"
            data-target="question-2"
          >
            <span class="exercise-tab__label">Q2</span>
            <span class="exercise-tab__title">顧客共創の提案</span>
          </button>
          <button
            id="tab-question-3"
            class="exercise-tab"
            type="button"
            role="tab"
            aria-selected="false"
            aria-controls="question-3"
            tabindex="-1"
            data-target="question-3"
          >
            <span class="exercise-tab__label">Q3</span>
            <span class="exercise-tab__title">技能伝承の仕組み</span>
          </button>
          <button
            id="tab-question-4"
            class="exercise-tab"
            type="button"
            role="tab"
            aria-selected="false"
            aria-controls="question-4"
            tabindex="-1"
            data-target="question-4"
          >
            <span class="exercise-tab__label">Q4</span>
            <span class="exercise-tab__title">評価制度の再設計</span>
          </button>
        </nav>
        <section class="exercise__questions" aria-live="polite">
          <article
            id="question-1"
            class="question-card"
            role="region"
            aria-labelledby="question-1-title"
            data-max-length="120"
          >
            <header class="question-card__header">
              <span class="question-card__badge">1</span>
              <h3 id="question-1-title" class="question-card__title">
                経営課題の整理
              </h3>
              <div class="question-card__meta">
                <span>配点 20点</span>
                <span>120字以内</span>
              </div>
            </header>
            <div class="question-card__body">
              A社が直面している主要な経営課題を、設計・生産・人材の観点
              から整理し、優先度の高い順に二点述べよ。
            </div>
            <div class="question-card__input">
              <label class="sr-only" for="answer-1">設問1回答欄</label>
              <textarea
                id="answer-1"
                class="question-card__textarea"
                maxlength="300"
                aria-describedby="counter-1"
                data-max-length="120"
              ></textarea>
              <div id="counter-1" class="char-counter" aria-live="polite">
                0 / 120 字
              </div>
            </div>
            <div class="support-block">
              <button
                class="support-block__toggle"
                type="button"
                aria-expanded="false"
                aria-controls="support-1"
                data-support-id="support-1"
              >
                <span class="icon icon--support" aria-hidden="true"></span>
                <span class="support-block__label">活用する 思考補助</span>
              </button>
              <div id="support-1" class="support-block__content" hidden>
                設計部門のDX化、BOM連携、技能伝承、人材評価の整合性など、
                与件文から直接引用できる語を起点に因果で整理する。
              </div>
            </div>
          </article>

          <article
            id="question-2"
            class="question-card"
            role="region"
            aria-labelledby="question-2-title"
            data-max-length="160"
          >
            <header class="question-card__header">
              <span class="question-card__badge">2</span>
              <h3 id="question-2-title" class="question-card__title">
                顧客共創の提案
              </h3>
              <div class="question-card__meta">
                <span>配点 30点</span>
                <span>160字以内</span>
              </div>
            </header>
            <div class="question-card__body">
              A社が顧客との共同開発を推進するための施策を、営業・設計・
              生産の連携の仕組みとして提案せよ。
            </div>
            <div class="question-card__input">
              <label class="sr-only" for="answer-2">設問2回答欄</label>
              <textarea
                id="answer-2"
                class="question-card__textarea"
                maxlength="400"
                aria-describedby="counter-2"
                data-max-length="160"
              ></textarea>
              <div id="counter-2" class="char-counter" aria-live="polite">
                0 / 160 字
              </div>
            </div>
            <div class="support-block">
              <button
                class="support-block__toggle"
                type="button"
                aria-expanded="false"
                aria-controls="support-2"
                data-support-id="support-2"
              >
                <span class="icon icon--support" aria-hidden="true"></span>
                <span class="support-block__label">確認する 注意事項</span>
              </button>
              <div id="support-2" class="support-block__content" hidden>
                顧客接点の情報共有タイミング、設計部門の早期参画、試作段
                階でのフィードバックループを盛り込む。
              </div>
            </div>
          </article>

          <article
            id="question-3"
            class="question-card"
            role="region"
            aria-labelledby="question-3-title"
            data-max-length="160"
          >
            <header class="question-card__header">
              <span class="question-card__badge">3</span>
              <h3 id="question-3-title" class="question-card__title">
                技能伝承の仕組み
              </h3>
              <div class="question-card__meta">
                <span>配点 25点</span>
                <span>160字以内</span>
              </div>
            </header>
            <div class="question-card__body">
              熟練技能の形式知化と継承を加速するための施策を、教育体系と
              デジタル活用の両面から述べよ。
            </div>
            <div class="question-card__input">
              <label class="sr-only" for="answer-3">設問3回答欄</label>
              <textarea
                id="answer-3"
                class="question-card__textarea"
                maxlength="400"
                aria-describedby="counter-3"
                data-max-length="160"
              ></textarea>
              <div id="counter-3" class="char-counter" aria-live="polite">
                0 / 160 字
              </div>
            </div>
            <div class="support-block">
              <button
                class="support-block__toggle"
                type="button"
                aria-expanded="false"
                aria-controls="support-3"
                data-support-id="support-3"
              >
                <span class="icon icon--support" aria-hidden="true"></span>
                <span class="support-block__label">参照する Tips</span>
              </button>
              <div id="support-3" class="support-block__content" hidden>
                指導員制度、ペアワーク、動画記録、工程別のナレッジカード
                など複数手段を組み合わせ、習熟度指標を定義する。
              </div>
            </div>
          </article>

          <article
            id="question-4"
            class="question-card"
            role="region"
            aria-labelledby="question-4-title"
            data-max-length="200"
          >
            <header class="question-card__header">
              <span class="question-card__badge">4</span>
              <h3 id="question-4-title" class="question-card__title">
                評価制度の再設計
              </h3>
              <div class="question-card__meta">
                <span>配点 25点</span>
                <span>200字以内</span>
              </div>
            </header>
            <div class="question-card__body">
              DX推進と技能伝承を両立させる評価制度・報酬制度の改善策を、
              期待する行動指標を含めて述べよ。
            </div>
            <div class="question-card__input">
              <label class="sr-only" for="answer-4">設問4回答欄</label>
              <textarea
                id="answer-4"
                class="question-card__textarea"
                maxlength="500"
                aria-describedby="counter-4"
                data-max-length="200"
              ></textarea>
              <div id="counter-4" class="char-counter" aria-live="polite">
                0 / 200 字
              </div>
            </div>
            <div class="support-block">
              <button
                class="support-block__toggle"
                type="button"
                aria-expanded="false"
                aria-controls="support-4"
                data-support-id="support-4"
              >
                <span class="icon icon--support" aria-hidden="true"></span>
                <span class="support-block__label">確認する ゴール像</span>
              </button>
              <div id="support-4" class="support-block__content" hidden>
                DXで創出した知見の共有や後進育成を評価指標に組み込み、成
                果とプロセスを両面評価する基準づくりを意識する。
              </div>
            </div>
          </article>
        </section>
        <footer class="exercise__footer">
          <button
            type="button"
            class="cta-button"
            id="next-question-button"
            data-target="question-2"
            aria-label="次の設問へ進む"
          >
            <span class="cta-button__verb">進む</span>
            <span class="cta-button__object">次の設問へ</span>
          </button>
        </footer>
      </main>
    </div>

    <script>
      (() => {
        const appRoot = document.querySelector('[data-app="exercise"]');
        if (!appRoot || appRoot.dataset.initialized === 'true') {
          return;
        }
        appRoot.dataset.initialized = 'true';

        const escapeSelector = (value) =>
          typeof value === 'string'
            ? value.replace(/([!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~])/g, '\\$1')
            : '';

        // 現在の設問位置とタブ／CTAの同期、スムーススクロール、ハイライト
        const tabButtons = Array.from(
          appRoot.querySelectorAll('.exercise-tab')
        );
        const tabList = appRoot.querySelector('.exercise__tabs');
        const nextButton = appRoot.querySelector('#next-question-button');
        const questionCards = Array.from(
          appRoot.querySelectorAll('.question-card')
        );
        const answerTextareas = appRoot.querySelectorAll(
          '.question-card__textarea'
        );

        const activateCard = (card) => {
          questionCards.forEach((c) =>
            c.classList.remove('question-card--active')
          );
          if (!card) return;
          card.classList.add('question-card--active');
          if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
            card.classList.remove('question-card--active');
          } else {
            setTimeout(() => {
              card.classList.remove('question-card--active');
            }, 2000);
          }
        };

        const updateTabs = (activeId) => {
          tabButtons.forEach((button) => {
            const isActive = button.dataset.target === activeId;
            button.setAttribute('aria-selected', String(isActive));
            button.setAttribute('tabindex', isActive ? '0' : '-1');
          });
        };

        const updateFooterCta = (activeId) => {
          if (!nextButton) return;
          const currentIndex = questionCards.findIndex(
            (card) => card.id === activeId
          );
          if (currentIndex === -1) {
            return;
          }

          const verb = nextButton.querySelector('.cta-button__verb');
          const object = nextButton.querySelector('.cta-button__object');
          const isLast = currentIndex === questionCards.length - 1;
          const nextIndex = isLast ? 0 : currentIndex + 1;
          nextButton.dataset.target = questionCards[nextIndex].id;
          if (verb && object) {
            if (isLast) {
              verb.textContent = '見直す';
              object.textContent = '1問目へ';
              nextButton.setAttribute('aria-label', '1問目へ戻る');
            } else {
              verb.textContent = '進む';
              object.textContent = '次の設問へ';
              nextButton.setAttribute('aria-label', '次の設問へ進む');
            }
          }
        };

        const scrollToQuestion = (targetId) => {
          const target = targetId
            ? appRoot.querySelector(`#${escapeSelector(targetId)}`)
            : null;
          if (!target) return;
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          if (target.focus) {
            try {
              target.focus({ preventScroll: true });
            } catch (error) {
              target.focus();
            }
          }
          activateCard(target);
          updateTabs(targetId);
          updateFooterCta(targetId);
        };

        tabButtons.forEach((button, index) => {
          button.addEventListener('click', () => {
            scrollToQuestion(button.dataset.target);
          });

          button.addEventListener('keydown', (event) => {
            const { key } = event;
            let nextIndex = index;
            if (key === 'ArrowRight' || key === 'ArrowDown') {
              nextIndex = (index + 1) % tabButtons.length;
            } else if (key === 'ArrowLeft' || key === 'ArrowUp') {
              nextIndex = (index - 1 + tabButtons.length) % tabButtons.length;
            } else if (key === 'Home') {
              nextIndex = 0;
            } else if (key === 'End') {
              nextIndex = tabButtons.length - 1;
            } else {
              return;
            }
            event.preventDefault();
            const nextButtonEl = tabButtons[nextIndex];
            nextButtonEl.focus();
            scrollToQuestion(nextButtonEl.dataset.target);
          });
        });

        if (tabList?.dataset.wheelScroll === 'true') {
          tabList.addEventListener(
            'wheel',
            (event) => {
              if (Math.abs(event.deltaY) <= Math.abs(event.deltaX)) {
                return;
              }
              event.preventDefault();
              tabList.scrollBy({
                left: event.deltaY,
                behavior: 'smooth',
              });
            },
            { passive: false }
          );
        }

        nextButton?.addEventListener('click', () => {
          const targetId = nextButton.dataset.target;
          if (targetId) {
            scrollToQuestion(targetId);
          }
        });

        if (questionCards.length) {
          updateFooterCta(questionCards[0].id);
        }

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                const id = entry.target.getAttribute('id');
                updateTabs(id);
                updateFooterCta(id);
                activateCard(entry.target);
              }
            });
          },
          {
            rootMargin: '-40% 0px -45% 0px',
            threshold: 0.1,
          }
        );

        questionCards.forEach((card) => {
          card.setAttribute('tabindex', '-1');
          observer.observe(card);
        });

        // 字数カウンタ：上限超過時は警告色を適用
        const updateCounter = (textarea, counter) => {
          const max = Number(textarea.dataset.maxLength);
          const length = textarea.value.length;
          const remaining = `${length} / ${max} 字`;
          counter.textContent = remaining;
          counter.classList.toggle('char-counter--limit', length > max);
        };

        const answerStorageKey = 'exercise-answer-drafts-v1';
        let answerDrafts = {};

        try {
          answerDrafts = JSON.parse(
            localStorage.getItem(answerStorageKey) || '{}'
          );
        } catch (error) {
          answerDrafts = {};
        }

        const persistDrafts = () => {
          try {
            const hasDrafts = Object.keys(answerDrafts).length > 0;
            if (hasDrafts) {
              localStorage.setItem(
                answerStorageKey,
                JSON.stringify(answerDrafts)
              );
            } else {
              localStorage.removeItem(answerStorageKey);
            }
          } catch (error) {
            // ストレージ未対応環境では静かにフォールバック
          }
        };

        answerTextareas.forEach((textarea) => {
          const describedBy = textarea.getAttribute('aria-describedby');
          const counter = describedBy
            ? appRoot.querySelector(`#${escapeSelector(describedBy)}`)
            : null;
          const textareaId = textarea.id;
          const savedDraft =
            textareaId && answerDrafts[textareaId]
              ? answerDrafts[textareaId]
              : null;

          if (savedDraft && typeof savedDraft.value === 'string') {
            textarea.value = savedDraft.value;
          }

          if (counter) {
            updateCounter(textarea, counter);
          }

          let saveTimer;

          const saveDraft = () => {
            if (!textareaId) return;
            if (textarea.value === '') {
              delete answerDrafts[textareaId];
            } else {
              answerDrafts[textareaId] = {
                value: textarea.value,
                savedAt: new Date().toISOString(),
              };
            }
            persistDrafts();
          };

          const scheduleSave = () => {
            clearTimeout(saveTimer);
            saveTimer = window.setTimeout(saveDraft, 300);
          };

          textarea.addEventListener('input', () => {
            if (counter) {
              updateCounter(textarea, counter);
            }
            scheduleSave();
          });

          textarea.addEventListener('blur', saveDraft);
          window.addEventListener('beforeunload', saveDraft);
        });

        // 折りたたみ補助情報：ローカルストレージで既読状態を保持
        const supportToggles = appRoot.querySelectorAll(
          '.support-block__toggle'
        );
        const storageKey = 'exercise-support-state-v1';
        let storedState = {};

        try {
          storedState = JSON.parse(localStorage.getItem(storageKey) || '{}');
        } catch (error) {
          storedState = {};
        }

        supportToggles.forEach((toggle) => {
          const supportId = toggle.dataset.supportId;
          const content = supportId
            ? appRoot.querySelector(`#${escapeSelector(supportId)}`)
            : null;
          if (!content) {
            return;
          }
          const isOpen = storedState[supportId];

          if (isOpen) {
            toggle.setAttribute('aria-expanded', 'true');
            content.hidden = false;
          }

          toggle.addEventListener('click', () => {
            const expanded = toggle.getAttribute('aria-expanded') === 'true';
            toggle.setAttribute('aria-expanded', String(!expanded));
            content.hidden = expanded;
            storedState[supportId] = !expanded;
            try {
              localStorage.setItem(storageKey, JSON.stringify(storedState));
            } catch (error) {
              // ストレージ未対応環境では静かにフォールバック
            }
          });
        });
      })();
    </script>
  </body>
</html>
